---
slug: secure-instance-with-fido2-key
title: "Secure your Compute Instances with Mobile FIDO2 Security Keys"
description: 'Learn how to use FIDO2 to access your compute instances via SSH.'
keywords: ['ssh','fido','security key','mobile','yubikey']
license: '[CC BY-ND 4.0](https://creativecommons.org/licenses/by-nd/4.0)'
authors: ["Bill Huang"]
published: 2023-05-15
modified_by:
  name: Linode
---

Password authentication has long been a common target of brute-force attacks by malicious actors. And, private keys stored in a usersâ€™ local machine are traditionally insecure, allowing attackers with local access to steal them and exploit systems.

Launched in 2013, the FIDO Alliance set out to develop stronger authentication; FIDO2 is the latest version of the standard. FIDO2 authentication is based on private/public key cryptography, does not depend on shared secrets, and ensures that the authentication challenge follows the same path as the request. Using the FIDO2 standard, the likelihood of successful system access with stolen keys or passwords is reduced significantly. FIDO2, in its native forms, is optimized for browser based accesses, but with recent changes to OpenSSH, FIDO2 can now be used to protect SSH logins. The additional benefit of using FIDO2 with SSH is that your private key is no longer stored on your local machine.

Linode's [Cloud Manager](/docs/products/tools/cloud-manager/) recently extended the support of SSH key types for account-wide remote access. Now, users can import SSH keys generated by mobile applications based on the FIDO2 standard. When a new instance is deployed, the FIDO2-generated SSH keys are stored in the server and are available to authenticate users. This enhancement allows users to use an innovative FIDO2 authenticator that is at the core of Akamai MFA.

[Akamai MFA](https://www.akamai.com/products/akamai-mfa) is a full-service MFA solution for the workforce, featuring a phish-proof FIDO2 authentication factor. However, the full Akamai MFA service is not required in order to support MFA for your compute instances. Rather, you only need the Akamai MFA mobile app, which is available for free in the Apple and Google stores, and Akamai akr. Akamai akr is an SSH agent that cooperates with the Akamai MFA mobile app to perform FIDO2-based authentication. Akamai akr serves as a bridge between your local machine and the Akamai MFA mobile app on your phone, while the Akamai MFA mobile app turns your phone into a FIDO2 authenticator. The FIDO2 private key that serves as your credential is securely stored on your phone (and never leaves the phone) while the actual challenge is presented to you as a phone notification.

## Requirements

-   **Supported operating systems:** macOS 10.15+, Debian 11+, Ubuntu 20.04+, AlmaLinux 9, Rocky Linux 9. Older versions of some Linux distributions may work *if* the OpenSSH package is upgraded to match the version requirement listed below. Upgrading OpenSSH is outside the scope of this guide.

-   **OpenSSH 8.2+:** The Akamai akr tool generates keys using the ECDSA algorithm with 256-bit strength and outputs them in the `sk-ecdsa-sha2-nistp256` format. Due to this, both the local system and any remote systems that use the public key must have OpenSSH 8.2 (or greater) installed. To check your OpenSSH version, run:

    ```command
    ssh -V
    ```

## Installing Akamai akr

### macOS

To start using FIDO2 authentication with Akamai akr, macOS users can install the agent with [Homebrew](https://brew.sh/).

1.  The OpenSSH version include on macOS Ventura (and earlier releases) does not support the necessary security keys features. To overcome this, install OpenSSH through Homebrew and update your PATH variable so that this new version is used instead of the default macOS version.

    ```command
    brew install openssh
    export PATH=$(brew --prefix openssh)/bin:$PATH
    ```

1.  Install akr and `pinentry-mac` through Homebrew.

    ```command
    brew install akamai/mfa/akr pinentry-mac
    ```

### Debian and Ubuntu

1.  Install GnuPG if you are using Debian. Ubuntu distributions should have this tool already installed.

    ```command
    sudo apt update
    sudo apt install gnupg
    ```

1.  Download the Akamai AKR key file and add it to the `/usr/share/keyrings/` directory.

    ```command
    curl -fsSL https://akamai.github.io/akr-pkg/ubuntu/KEY.gpg | gpg --dearmor | sudo tee /usr/share/keyrings/akr.gpg > /dev/null
    ```

1.  Add the Akamai AKR repository.

    ```command
    echo "deb [signed-by=/usr/share/keyrings/akr.gpg] https://akamai.github.io/akr-pkg/ubuntu ./" | sudo tee /etc/apt/sources.list.d/akr.list
    ```

1.  Install the `akr` and `pinentry-tty` packages.

    ```command
    sudo apt update
    sudo apt install akr pinentry-tty
    ```

### CentOS Stream 9 and RHEL derivatives

1.  Create a repo file for the akr package repo.

    ```command
    sudo vim /etc/yum.repos.d/akr.repo
    ```

1.  Add the following contents to that file:

    ```file {title="/etc/yum.repos.d/akr.repo"}
    [akr]
    name=akr repository
    baseurl=https://akamai.github.io/akr-pkg/rpm-9/
    gpgcheck=0
    enabled=1
    ```

1.  Install the `akr` package along with `pinentry`.

    ```command
    sudo dnf -y install akr pinentry
    ```

### Manually Build akr with Rust

You can also build the application with Rust from the repository. You need to make sure Rust (https://rustup.rs) is installed, then you can run `cargo build` to build the application locally.

## Pairing akr with a Mobile Device

When you have Akamai akr installed, you can follow the steps outlined here to set up the agent and pair it with the mobile device.

1.  Write the configuration and initiate the agent.

    ```command
    akr setup
    ```

    This command attempts to write to the SSH client configuration file in the path `~/.ssh/config`. If this file doesn't exist, you will receive a file IO error that indicates the file can't be found. To overcome this, create the file manually using the command below and then rerun `akr setup`:

    ```command
    mkdir -p ~/.ssh/ && touch ~/.ssh/config
    ```

1.  Run the pair command, which generates a QR code.

    ```command
    akr pair
    ```

1.  Scan the generated QR code with the Akamai MFA Authenticator app to pair the device and the akr agent.

1.  Generate an SSH key pair in Akamai MFA with the generate command, being sure to provide your own key name.

    ```command
    akr generate --name <key name>
    ```

1.  An SSH key is generated using the `sk-ecdsa-sha2-nistp256` file format. Retain this public key so you can install it on any systems you wish to access through Akamai MFA.

## Adding the SSH Key to Cloud Manager

1.  In [Cloud Manager](https://cloud.linode.com), click on your username in the top right to open the settings menu, and choose **SSH Keys**.

1.  Click **Add An SSH Key**.

1.  Create a label for this SSH key, and paste in the FIDO2 SSH key you generated locally in the previous section.

1.  Then, click "Add Key."

After you add the public key to your account in Cloud Manager, you can choose to [add this public key to your Compute Instances as they are created](/docs/products/compute/compute-instances/guides/create/#create-a-password-and-add-ssh-keys), allowing you to immediately and securely log in via SSH.

## Logging Into a Compute Instance with a FIDO2 SSH Key

When the compute instance has finished provisioning and is in a running state, you can [connect to it via SSH](/docs/products/compute/compute-instances/guides/set-up-and-secure/#connect-to-the-instance). After the host public key fingerprint is validated, you'll receive a push-based prompt on your phone to verify the connection attempt. Once the connect request is approved, you see a successful login in the original interface.